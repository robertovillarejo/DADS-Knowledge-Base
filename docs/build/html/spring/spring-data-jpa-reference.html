

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Spring Data JPA - Documentación de referencia &mdash; documentación de Base de conocimientos - 0.1</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Índice"
              href="../genindex.html"/>
        <link rel="search" title="Búsqueda" href="../search.html"/>
    <link rel="top" title="documentación de Base de conocimientos - 0.1" href="../index.html"/>
        <link rel="up" title="Spring: documentación en español" href="index.html"/>
        <link rel="next" title="Spring Boot: Guía de referencia" href="spring-boot-reference.html"/>
        <link rel="prev" title="Spring: documentación en español" href="index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Base de conocimientos
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">General</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../description.html">Descripción</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">Licencia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about-developer.html">Sobre el Desarrollador</a></li>
</ul>
<p class="caption"><span class="caption-text">JHipster</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../jhipster/index.html">JHipster</a></li>
</ul>
<p class="caption"><span class="caption-text">Spring</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Spring: documentación en español</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Spring Data JPA - Documentación de referencia</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dependencias">3. Dependencias</a></li>
<li class="toctree-l3"><a class="reference internal" href="#administracion-de-dependencias-con-spring-boot">3.1 Administración de dependencias con Spring Boot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#el-framework-spring">3.2 El Framework Spring</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trabajando-con-repositorios-spring-data">4. Trabajando con Repositorios Spring Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conceptos-basicos">4.1 Conceptos básicos</a></li>
<li class="toctree-l3"><a class="reference internal" href="#metodos-de-consulta">4.2 Métodos de consulta</a></li>
<li class="toctree-l3"><a class="reference internal" href="#definiendo-interfaces-de-repositorios">4.3 Definiendo interfaces de repositorios</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#definicion-de-grano-fino-de-repositorio">4.3.1 Definición de grano fino de repositorio</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usando-repositorios-con-multiples-modulos-de-spring-data">4.3.2 Usando Repositorios con múltiples módulos de Spring Data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#definiendo-metodos-de-consulta">4.4 Definiendo métodos de consulta</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#estrategias-de-busqueda-de-consultas">4.4.1 Estrategias de búsqueda de consultas</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creacion-de-queries">4.4.2 Creación de <em>queries</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#expresiones-de-propiedad">4.4.3 Expresiones de propiedad</a></li>
<li class="toctree-l4"><a class="reference internal" href="#manejo-de-parametros-especiales">4.4.4 Manejo de parámetros especiales</a></li>
<li class="toctree-l4"><a class="reference internal" href="#limitando-los-resultados-de-los-queries">4.4.5 Limitando los resultados de los <em>queries</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#streaming-de-resultados-de-queries">4.4.6 <em>Streaming</em> de resultados de <em>queries</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#resultados-de-queries-asincronos">4.4.7 Resultados de _queries _asíncronos</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="spring-boot-reference.html">Spring Boot: Guía de referencia</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Arquitectura</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arquitectura/index.html">Arquitectura</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Base de conocimientos</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Spring: documentación en español</a> &raquo;</li>
        
      <li>Spring Data JPA - Documentación de referencia</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/spring/spring-data-jpa-reference.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="spring-data-jpa-documentacion-de-referencia">
<span id="spring-data-jpa-documentacion-de-referencia"></span><h1>Spring Data JPA - Documentación de referencia<a class="headerlink" href="#spring-data-jpa-documentacion-de-referencia" title="Enlazar permanentemente con este título">¶</a></h1>
<p><a class="reference external" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#dependencies.spring-framework">Documento original</a></p>
<div class="section" id="dependencias">
<span id="dependencias"></span><h2>3. Dependencias<a class="headerlink" href="#dependencias" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Debido a las diferentes fechas de creación de los módulos individuales de Spring Data, la mayoría de ellos llevan números diferentes de versiones mayores y menores. La manera más fácil de encontrar compatibles es confiando en el <em>Spring Data Release Train BOM</em>. En un proyecto Maven declararías esta dependencia en la sección <p>&amp;lt;</p>
dependencyManagement/<p>&amp;gt;</p>
  de tu POM:</p>
<p>**Ejemplo 1: Usando el **_**release train **_<strong>de Spring Data</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependencyManagement&gt;</span>
  <span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.springframework.data<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>spring-data-releasetrain<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>${release-train}<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
      <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/dependencyManagement&gt;</span>
</pre></div>
</div>
<p>La versión actual del <em>release train</em> es <em>Ingalls-SR6</em>. Los nombres del <em>train _se encuentran disponibles y ordenados alfabéticamente <em><a class="reference external" href="https://github.com/spring-projects/spring-data-commons/wiki/Release-planning"><em>aquí</em></a></em>. El nombre de la versión sigue el siguiente patrón: <em><code class="docutils literal"><span class="pre">${name}-${release}</span></code></em> donde _release</em> puede ser uno de los siguientes:</p>
<ul class="simple">
<li>BUILD-SNAPSHOT - snapshots actuales</li>
<li>M1, M2 etc. - milestones (hitos)</li>
<li>RC1, RC2 etc. - candidatos de lanzamiento</li>
<li>RELEASE - GA release (lanzamiento de disponibilidad general)</li>
<li>SR1, SR2 etc. - lanzamientos de servicio</li>
</ul>
<p>Un ejemplo de trabajo de uso de BOMs (<em>Bills of materials</em>; Lista de materiales) se encuentra en nuestro <a class="reference external" href="https://github.com/spring-projects/spring-data-examples/tree/master/bom">repositorio de ejemplos de Spring Data</a>. Si eso está en su lugar declara, sin especificar ninguna versión, los módulos de Spring Data que te gustaría usar en el bloque <em><p>&amp;lt;</p>
dependencies /<p>&amp;gt;</p>
</em>.</p>
<p><strong>Ejemplo 2: Declarando una dependencia a un módulo de Spring Data</strong></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependencies&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.data<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-data-jpa<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependencies&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="administracion-de-dependencias-con-spring-boot">
<span id="administracion-de-dependencias-con-spring-boot"></span><h2>3.1 Administración de dependencias con Spring Boot<a class="headerlink" href="#administracion-de-dependencias-con-spring-boot" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Spring Boot selecciona por ti una versión muy reciente de los módulos de Spring Data. No obstante, en caso que desees actualizar a una nueva versión, simplemente configura la propiedad <em>spring-data-releasetrain.version</em> al nombre del tren e iteración que te gustaría usar.</p>
</div>
<div class="section" id="el-framework-spring">
<span id="el-framework-spring"></span><h2>3.2 El Framework Spring<a class="headerlink" href="#el-framework-spring" title="Enlazar permanentemente con este título">¶</a></h2>
<p>La versión actual de los módulos de Spring Data requiere la versión 4.3.10.RELEASE de Spring Framework o una versión mayor. Los módulos también podrían funncionar con una versión <em>bugfix</em> anterior de esa versión menor. Sin embargo, es altamente recomendable utilizar la versión más reciente dentro de esa generación.</p>
</div>
<div class="section" id="trabajando-con-repositorios-spring-data">
<span id="trabajando-con-repositorios-spring-data"></span><h2>4. Trabajando con Repositorios Spring Data<a class="headerlink" href="#trabajando-con-repositorios-spring-data" title="Enlazar permanentemente con este título">¶</a></h2>
<p>El propósito de la abstracción del repositorio Spring Data es reducir significativamente la cantidad de código repetitivo (<em>boilerplate code</em>) requerido para implementar capas de acceso de datos para varios almacenes de persistencia.</p>
<blockquote>
<div><p>La documentación de repositorio Spring Data y tu módulo</p>
<p>...</p>
</div></blockquote>
</div>
<div class="section" id="conceptos-basicos">
<span id="conceptos-basicos"></span><h2>4.1 Conceptos básicos<a class="headerlink" href="#conceptos-basicos" title="Enlazar permanentemente con este título">¶</a></h2>
<p>La interfaz central en la abstracción del repositorio de Spring Data es <em>Repository</em> (probablemente no es sorpresa). Ésta toma la clase dominio para administrara tanto el tipo de id de la clase dominio como el tipo de argumentos. Esta interfaz actúa principalmente como una interfaz de marcado para capturar los tipos con los que hay que trabajar y te ayuda a descubrir interfaces que extienden de ésta. El <em>CrudRepository</em> proporciona sofisticada funcionalidad CRUD para la clase entidad que se está gestionando.</p>
<p>**Ejemplo 3: Interfaz **<em><strong>CrudRepository</strong></em></p>
<div class="highlight-default"><div class="highlight"><pre><span></span>public interface CrudRepository&lt;T, ID extends Serializable&gt;
    extends Repository&lt;T, ID&gt; {

    &lt;S extends T&gt; S save(S entity); // Guarda la entidad

    T findOne(ID primaryKey);       // Retorna la entidad identificada por ese id

    Iterable&lt;T&gt; findAll();          // Retorna todas las entidades

    Long count();                   // Retorna el número de entidades

    void delete(T entity);          // Elimina la entidad proporcionada

    boolean exists(ID primaryKey);  // Indica si existe una entidad con tal id

    // … more functionality omitted.
}
</pre></div>
</div>
<blockquote>
<div>También proporcionamos abstracciones de tecnología específica como por ejemplo _**JpaRepository **_o <em><strong>MongoRepository</strong></em>. Esas interfaces extienden de _<strong>CrudRepository</strong>_ y exponen las capacidades de la tecnología de la persistencia subyacente además de las interfaces de tecnología-agnóstica que son más bien genéricas como por ejemplo CrudRepository.</div></blockquote>
<p>Encima del <em>CrudRepository</em> existe una abstracción <em>PagingAndSortingRepository</em> que añade métodos adicionales para facilitar el acceso paginado a entidades:</p>
<p><strong>Ejemplo 4. PagingAndSortingRepository</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PagingAndSortingRepository</span><span class="o">&lt;</span><span class="n">T</span><span class="o">,</span> <span class="n">ID</span> <span class="kd">extends</span> <span class="n">Serializable</span><span class="o">&gt;</span>
  <span class="kd">extends</span> <span class="n">CrudRepository</span><span class="o">&lt;</span><span class="n">T</span><span class="o">,</span> <span class="n">ID</span><span class="o">&gt;</span> <span class="o">{</span>

  <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">(</span><span class="n">Sort</span> <span class="n">sort</span><span class="o">);</span>

  <span class="n">Page</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">(</span><span class="n">Pageable</span> <span class="n">pageable</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Para acceder a la segunda página de un <em>User</em> por una página de tamaño 20 podrías simplemente hacer algo como esto:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">PagingAndSortingRepository</span><span class="o">&lt;</span><span class="n">User</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="n">repository</span> <span class="o">=</span> <span class="c1">// … get access to a bean</span>
<span class="n">Page</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="n">repository</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span><span class="k">new</span> <span class="n">PageRequest</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">20</span><span class="o">));</span>
</pre></div>
</div>
<p>Además de los métodos de consulta, está disponible la derivación de consultas para los <em>queries</em> <em>count _y _delete</em>.</p>
<p><strong>Ejemplo 5. Consulta <strong><em><strong>Count</strong></em></strong> derivada</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserRepository</span> <span class="kd">extends</span> <span class="n">CrudRepository</span><span class="o">&lt;</span><span class="n">User</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="o">{</span>

  <span class="n">Long</span> <span class="nf">countByLastname</span><span class="o">(</span><span class="n">String</span> <span class="n">lastname</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>**Ejemplo 6. Consulta **_**Delete **_<strong>derivada</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserRepository</span> <span class="kd">extends</span> <span class="n">CrudRepository</span><span class="o">&lt;</span><span class="n">User</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="o">{</span>

  <span class="n">Long</span> <span class="nf">deleteByLastname</span><span class="o">(</span><span class="n">String</span> <span class="n">lastname</span><span class="o">);</span>

  <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">removeByLastname</span><span class="o">(</span><span class="n">String</span> <span class="n">lastname</span><span class="o">);</span>

<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="metodos-de-consulta">
<span id="metodos-de-consulta"></span><h2>4.2 Métodos de consulta<a class="headerlink" href="#metodos-de-consulta" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Los repositorios estándar de funcionalidad CRUD usualmente tienen consultas sobre el subyacente almacén de datos. Con Spring Data, declarar esas consultas se convierte en un proceso de cuatro pasos:</p>
<ol>
<li><p class="first">Declara una interfaz que extienda de Repository o una de sus subinterfaces y escribe la clase de dominio y el tipo del ID que manejará.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>interface PersonRepository extends Repository&lt;Person,Long&gt;{…}
</pre></div>
</div>
</li>
<li><p class="first">Declara los métodos de consulta en la interfaz.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">interface</span> <span class="nc">PersonRepository</span> <span class="kd">extends</span> <span class="n">Repository</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="nf">findByLastname</span><span class="o">(</span><span class="n">String</span> <span class="n">lastname</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
</li>
<li><p class="first">Prepara a Spring para crear instancias proxy para esas interfaces. Puede ser mediante <a class="reference external" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.create-instances.java-config">JavaConfig</a>:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.config.EnableJpaRepositories</span><span class="o">;</span>

<span class="nd">@EnableJpaRepositories</span>
<span class="kd">class</span> <span class="nc">Config</span> <span class="o">{}</span>
</pre></div>
</div>
</li>
</ol>
<p>o mediante <a class="reference external" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.create-instances">configuración XML:</a></p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
   <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
   <span class="na">xmlns:jpa=</span><span class="s">&quot;http://www.springframework.org/schema/data/jpa&quot;</span>
   <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans</span>
<span class="s">     http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">     http://www.springframework.org/schema/data/jpa</span>
<span class="s">     http://www.springframework.org/schema/data/jpa/spring-jpa.xsd&quot;</span><span class="nt">&gt;</span>

   <span class="nt">&lt;jpa:repositories</span> <span class="na">base-package=</span><span class="s">&quot;com.acme.repositories&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>
</div>
<p>En este ejemplo se usa el <em>namespace</em> JPA. Si estás usando la abstracción de repositorio para cualquier otro almacén, necesitas cambiar este a la declaración apropiada del <em>namespace</em> de tu módulo de almacenamiento el cual debería estar intercambiando <em>jpa</em> en favor de, por ejemplo, <em>mongodb.</em></p>
<p>Nota, también, que la variante JavaConfig no configura explícitamente un paquete como el paquete de la clase anotada es usado por defecto. To customize the package to scan use one of the <code class="docutils literal"><span class="pre">basePackage…</span></code>attribute of the data-store specific repository <code class="docutils literal"><span class="pre">&#64;Enable…</span></code>-annotation.</p>
<ol class="simple">
<li>Inyecta la instancia del repositorio y úsala.</li>
</ol>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SomeClient</span> <span class="o">{</span>

  <span class="nd">@Autowired</span>
  <span class="kd">private</span> <span class="n">PersonRepository</span> <span class="n">repository</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">repository</span><span class="o">.</span><span class="na">findByLastname</span><span class="o">(</span><span class="s">&quot;Matthews&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>La siguiente sección explica cada paso en detalle.</p>
</div>
<div class="section" id="definiendo-interfaces-de-repositorios">
<span id="definiendo-interfaces-de-repositorios"></span><h2>4.3 Definiendo interfaces de repositorios<a class="headerlink" href="#definiendo-interfaces-de-repositorios" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Como primer paso puedes definir una interfaz de repositorio de una clase de dominio específica. La interfaz debe extender de Repository y escribirle la clase de dominio y el tipo de dato del ID. Si deseas exponer métodos CRUD para ese tipo de dominio, extiende de CrudRepository en lugar de Repository.</p>
<div class="section" id="definicion-de-grano-fino-de-repositorio">
<span id="definicion-de-grano-fino-de-repositorio"></span><h3>4.3.1 Definición de grano fino de repositorio<a class="headerlink" href="#definicion-de-grano-fino-de-repositorio" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Normalmente, tu interfaz de repositorio extenderá de <em>Repository</em>, <em>CrudRepository</em> o <em>PagingAndSortingRepository</em>. Alternativamente, si no quieres extender de las interfaces de Spring Data, también puedes anotar tu interfaz de repositorio con <em>&#64;RepositoryDefinition</em>. Al extender de <em>CrudRepository</em> se expone un completo conjunto de métodos para manipular tus entidades. Si prefieres ser selectivo sobre los métodos que se están exponiendo, simplemente copia de <em>CrudRepository</em> los que quieres exponer y pégalos en tu repositorio de dominio.</p>
<blockquote>
<div>Esto permite definir tus propias abstracciones sobre las funcionalidades que proporcionan los Repositorios de Spring Data.</div></blockquote>
<p><strong>Ejemplo 8: Exponiendo métodos CRUD de manera selectiva</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@NoRepositoryBean</span>
<span class="n">interface</span> <span class="n">MyBaseRepository</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">ID</span> <span class="n">extends</span> <span class="n">Serializable</span><span class="o">&gt;</span> <span class="n">extends</span> <span class="n">Repository</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">ID</span><span class="o">&gt;</span> <span class="p">{</span>

  <span class="n">T</span> <span class="n">findOne</span><span class="p">(</span><span class="n">ID</span> <span class="nb">id</span><span class="p">);</span>

  <span class="n">T</span> <span class="n">save</span><span class="p">(</span><span class="n">T</span> <span class="n">entity</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">interface</span> <span class="n">UserRepository</span> <span class="n">extends</span> <span class="n">MyBaseRepository</span><span class="o">&lt;</span><span class="n">User</span><span class="p">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="n">User</span> <span class="n">findByEmailAddress</span><span class="p">(</span><span class="n">EmailAddress</span> <span class="n">emailAddress</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>En este primer paso se define una interfaz de base común para todos tus repositorios de domino y se expone <em>findOne(...)</em> así como <em>save(...)</em>. Estos métodos se enviarán a la implementación base de repositorio del almacén de tu elección provista por Spring Data, por ejemplo en el caso de JPA sería <em>SimpleJpaRepository, _porque coinciden con las firmas del método en _CrudRepository</em>. Así que el <em>UserRepository</em> ahora será capaz de guardar usuarios y encontrarlos por id, así como definir una consulta para encontrar <em>Users</em> por su <em>e-mail</em>.</p>
<blockquote>
<div>Nota que la interfaz de repositorio intermedia se encuentra anotada con <em>&#64;NoRepositoryBean</em>. Asegúrate de añadir esa anotación a todos las interfaces de repositorio de las que no deseas que Spring Data cree instancias en tiempo de ejecución.</div></blockquote>
</div>
<div class="section" id="usando-repositorios-con-multiples-modulos-de-spring-data">
<span id="usando-repositorios-con-multiples-modulos-de-spring-data"></span><h3>4.3.2 Usando Repositorios con múltiples módulos de Spring Data<a class="headerlink" href="#usando-repositorios-con-multiples-modulos-de-spring-data" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Usar un único módulo de Spring Data en tu aplicación hace las cosas sencillas, todas las interfaces de repositorio en el alcance definido se encuentran ligadas al módulo de Spring Data. A veces las aplicaciones requieren usar más de un módulo de Spring Data. En tal caso, se requiere que una definición de repositorio distinga entre tecnologías de persistencia. Spring Data entra en modo de configuración estricta de repositorio porque detecta múltiples fábricas de repositorio en el <em>class path</em>. La configuración estricta requiere detalles en el repositorio o la clase de dominio para decidir sobre a qué módulo de Spring Data ligar a la definición del repositorio:</p>
<ol class="simple">
<li>Si la definición del repositorio **extiende de un repositorio específico de módulo, **entonces es un candidato válido para ese particular módulo de Spring Data.</li>
<li>Si la clase de dominio se encuentra <strong>anotada con el tipo de anotación específica de módulo</strong>, entonces es un candidato válido para ese particular módulo de Spring Data. Los módulos de Spring Data aceptan cualquier anotación de terceros (tales como entidades de JPA; <em>JPA's &#64;Entity</em>) o proporcionan anotaciones propias tales como <em>&#64;Document</em> para Spring Data MongoDB/Spring Data Elasticsearch.</li>
</ol>
<p><strong>Ejemplo 8. Definiciones de repositorios utilizando Interfaces específicas de módulos</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span>interface MyRepository extends JpaRepository&lt;User, Long&gt; { }

@NoRepositoryBean
interface MyBaseRepository&lt;T, ID extends Serializable&gt; extends JpaRepository&lt;T, ID&gt; {
  …
}

interface UserRepository extends MyBaseRepository&lt;User, Long&gt; {
  …
}
</pre></div>
</div>
<p><em>MyRepository</em> y <em>UserRepository</em> extienden de <em>JpaRepository</em> en su jerarquía de tipos. Éstos son candidatos válidos para el módulo Spring Data JPA.</p>
<p><strong>Ejemplo 9. Definiciones de Repositorios utilizando Interfaces genéricas</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span>interface AmbiguousRepository extends Repository&lt;User, Long&gt; {
 …
}

@NoRepositoryBean
interface MyBaseRepository&lt;T, ID extends Serializable&gt; extends CrudRepository&lt;T, ID&gt; {
  …
}

interface AmbiguousUserRepository extends MyBaseRepository&lt;User, Long&gt; {
  …
}
</pre></div>
</div>
<p><em>AmbiguosRepository _y _AmbigousUserRepository</em> extienden solo de _Repository _y _CrudRepository _en su jerarquía de tipos. Aunque está perfectamente bien utilizar un único módulo de Spring Data, múltiples módulos no pueden distinguir a cuál módulo en particular deben enlazarse estos repositorios.</p>
<p><strong>Ejemplo 10. Definiciones de Repositorios utilizando Clases de Dominio con Anotaciones</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span>interface PersonRepository extends Repository&lt;Person, Long&gt; {
 …
}

@Entity
public class Person {
  …
}

interface UserRepository extends Repository&lt;User, Long&gt; {
 …
}

@Document
public class User {
  …
}
</pre></div>
</div>
<p><em>PersonRepository _hace referencia a _Person</em> el cual se encuentra anotado con la anotación JPA <em>&#64;Entity</em> así que este repositorio pertenece claramente a Spring Data JPA. El <em>UserRepository</em> utiliza a <em>User</em> anotado con la anotación <em>&#64;Document</em> de Spring Data MongoDB.</p>
<p><strong>Ejemplo 11. Definiciones de Repositorios utilizando Clases de Dominio con Anotaciones mixtas</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span>interface JpaPersonRepository extends Repository&lt;Person, Long&gt; {
 …
}

interface MongoDBPersonRepository extends Repository&lt;Person, Long&gt; {
 …
}

@Entity
@Document
public class Person {
  …
}
</pre></div>
</div>
<p>Este ejemplo muestra una clase de dominio usando tanto anotaciones JPA como anotaciones Spring Data MongoDB. Ésta define dos repositorios, <em>JpaPersonRepository</em> y <em>MongoDBPersonRepository</em>. Uno está destinado para uso con JPA y otro para uso con MongoDB. Spring Data no es capaz de distinguir a los repositorios lo que conduce a un comportamiento indefinido.</p>
<p><a class="reference external" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.multiple-modules.types">Los detalles del tipo de repositorio</a> y la <a class="reference external" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.multiple-modules.annotations">identificación de anotaciones de clases de dominio</a> se utilizan para la configuración estricta del repositorio identificando así candidatos de repositorio para un módulo particular de Spring Data. Es posible utilizar múltiples anotaciones de persistencia de tecnologías específicas en el mismo tipo de dominio a través de múltiples tecnologías de persistencia, pero entonces Spring Data no será capaz de determinar un único módulo para enlazar el repositorio.</p>
<p>La manera anterior de distinguir repositorios es determinar el alcance de los paquetes base. Los paquetes base definen los puntos de inicio para el escaneo de definiciones de interfaces de repositorio lo cual implica tener definiciones  de repositorio ubicadas en los paquetes apropiados. Por defecto, la configuración por anotaciones utiliza el paquete de la clase de configuración. En la configuración por XML el paquete base es requerido.</p>
<p><strong>Ejemplo 12. Configuración de paquetes base por medio de anotaciones</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@EnableJpaRepositories</span><span class="o">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="s">&quot;com.acme.repositories.jpa&quot;</span><span class="o">)</span>
<span class="nd">@EnableMongoRepositories</span><span class="o">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="s">&quot;com.acme.repositories.mongo&quot;</span><span class="o">)</span>
<span class="kd">interface</span> <span class="nc">Configuration</span> <span class="o">{</span> <span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="definiendo-metodos-de-consulta">
<span id="definiendo-metodos-de-consulta"></span><h2>4.4 Definiendo métodos de consulta<a class="headerlink" href="#definiendo-metodos-de-consulta" title="Enlazar permanentemente con este título">¶</a></h2>
<p>El repositorio proxy tiene dos maneras de derivar una consulta de almacén específico basado en el nombre del método. Puede derivar la consulta directamente del nombre del método o usando una consulta definida manualmente. La opciones disponibles dependen del almacén real. Sin embargo, tiene que ser una estrategia que decida cuál consulta en concreto se crea. Revisemos las opciones disponibles.</p>
<div class="section" id="estrategias-de-busqueda-de-consultas">
<span id="estrategias-de-busqueda-de-consultas"></span><h3>4.4.1 Estrategias de búsqueda de consultas<a class="headerlink" href="#estrategias-de-busqueda-de-consultas" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Las siguientes estrategias están disponibles para la infraestructura del repositorio para resolver la consulta. Puedes configurar la estrategia en el <em>namespace</em> mediante el atributo <em>query-lookup-strategy</em> en el caso de configuración por XML o en el caso de configuración por Java mediante el atributo <em>queryLookupStrategy</em> en la anotaciónEnable${store}Repositores. Algunas estrategias podrían no estar soportadas para <em>datastores</em> particulares.</p>
<ul class="simple">
<li>CREATE trata de construir con <em>query</em> específico del almacén a partir del nombre del método. El enfoque general es remover del nombre del método un conjunto de prefijos ya conocidos  y analizar el resto del método. Lee más sobre la construcción de <em>queries</em> en <a class="reference external" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.query-methods.query-creation"><strong>Creación de queries</strong>.</a></li>
</ul>
<ul class="simple">
<li>USE_DECLARED_QUERY trata de encontrar un <em>query</em> definido y en caso de no encontrarlo lanzará una excepción. El <em>query</em> puede definirse con una anotación en algún lugar o puede ser declarado por otros medios. Consulta la documentación del almacén específico para encontrar opciones disponibles para dicho almacén. Si la infraestructura del repositorio no encuentra un <em>query</em> declarado para el método en tiempo de arranque éste falla.</li>
</ul>
<ul class="simple">
<li>CREATE_IF_NOT_FOUND (por defecto) combina <em>CREATE</em> y <em>USE_DECLARED_QUERY</em>. Primero busca un <em>query</em> declarado y si no encuentra ninguno, crea un _query _personalizado basándose en el nombre del método. Por defecto esta es la estrategia de búsqueda y por tanto se usará si no configuras nada explícitamente. Esto permite la definición rápida de la <em>queries</em> mediante nombres de métodos, pero también la personalización de estos _queries _mediante la introducción de <em>queries</em> declarados según sea necesario.</li>
</ul>
</div>
<div class="section" id="creacion-de-queries">
<span id="creacion-de-queries"></span><h3>4.4.2 Creación de <em>queries</em><a class="headerlink" href="#creacion-de-queries" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El mecanismo de construcción de <em>queries</em> integrado en la infraestructura de Spring Data repository es útil para construir <em>queries</em> restringidos sobre las entidades del repositorio. El mecanismo quita del método los prefijos <em>find...By</em>, <em>read...By</em>, <em>query...By</em>, _count...By _y <em>get...By</em> y analiza el resto. La cláusula que se introduzca puede contener otras expresiones como <em>Distinct</em> para establecer una bandera de 'distintos' en el <em>query</em> que se crea. Sin embargo, el primer <em>By</em> actúa como delimitador para indicar el inicio del criterio real. En un nivel muy básico puedes definir condiciones o propiedades de entidad y concatenarlas con _And _y <em>Or</em>.</p>
<p><strong>Ejemplo 13. Creación de <strong><em><strong>queries</strong></em></strong> a partir de los nombres de los métodos</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PersonRepository</span> <span class="kd">extends</span> <span class="n">Repository</span><span class="o">&lt;</span><span class="n">User</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="o">{</span>

  <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="nf">findByEmailAddressAndLastname</span><span class="o">(</span><span class="n">EmailAddress</span> <span class="n">emailAddress</span><span class="o">,</span> <span class="n">String</span> <span class="n">lastname</span><span class="o">);</span>

  <span class="c1">// Enables the distinct flag for the query</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="nf">findDistinctPeopleByLastnameOrFirstname</span><span class="o">(</span><span class="n">String</span> <span class="n">lastname</span><span class="o">,</span> <span class="n">String</span> <span class="n">firstname</span><span class="o">);</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="nf">findPeopleDistinctByLastnameOrFirstname</span><span class="o">(</span><span class="n">String</span> <span class="n">lastname</span><span class="o">,</span> <span class="n">String</span> <span class="n">firstname</span><span class="o">);</span>

  <span class="c1">// Enabling ignoring case for an individual property</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="nf">findByLastnameIgnoreCase</span><span class="o">(</span><span class="n">String</span> <span class="n">lastname</span><span class="o">);</span>
  <span class="c1">// Enabling ignoring case for all suitable properties</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="nf">findByLastnameAndFirstnameAllIgnoreCase</span><span class="o">(</span><span class="n">String</span> <span class="n">lastname</span><span class="o">,</span> <span class="n">String</span> <span class="n">firstname</span><span class="o">);</span>

  <span class="c1">// Enabling static ORDER BY for a query</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="nf">findByLastnameOrderByFirstnameAsc</span><span class="o">(</span><span class="n">String</span> <span class="n">lastname</span><span class="o">);</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="nf">findByLastnameOrderByFirstnameDesc</span><span class="o">(</span><span class="n">String</span> <span class="n">lastname</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>El resultado real del análisis gramatical de los métodos depende del almacenamiento de persistencia para el cual creaste el <em>query</em>. Sin embargo, hay algunas cosas generales que notar:</p>
<ul class="simple">
<li>Las expresiones usualmente son propiedades concatenadas mediante operadores. Puedes combinar las expresiones de propiedad con _AND _y <em>OR</em>. También tienes soporte para operadores como <em>Between</em>, <em>LessThan</em>, <em>GreaterThan</em>, <em>Like</em> para las expresiones de propiedad. Los operadores soportados pueden variar por <em>datastore</em>, así que consulta la parte apropiada de tu documentación de referencia.</li>
<li>El analizador de métodos soporta el establecimiento de una bandera para propiedades individuales (por ejemplo, <em>findByLastnameAndFirstnameAllIgnoreCase(...)</em>). El <em>IgnoreCase</em> puede o no estar soportado dependiendo del almacén, así que consulta las secciones relevantes en la documentación de referencia para el método de consulta_ _específico del almacén.</li>
<li>Puedes aplicar ordenamiento estático añadiendo una cláusula <em>OrderBy</em> al método de consulta que hace referencia a una propiedad y proporcionar una dirección al ordenamiento (<em>Asc</em> o <em>Desc</em>). Para crear un método de consulta que soporte ordenamiento dinámico, consulta <em>Manejo parámetros especiales</em>.</li>
</ul>
</div>
<div class="section" id="expresiones-de-propiedad">
<span id="expresiones-de-propiedad"></span><h3>4.4.3 Expresiones de propiedad<a class="headerlink" href="#expresiones-de-propiedad" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Las expresiones de propiedad pueden referirse solo a propiedades directas de la entidad que se administra, como se mostró en el ejemplo anterior. En la creación del _query _te aseguras que la propiedad que escribes en el nombre del método es una propiedad de la clase de dominio gestionada. Sin embargo, también puedes definir restricciones anotando propiedades anidadas. Supón que una <em>Person</em> tiene una <em>Address</em> con un <em>ZipCode</em>. En ese caso un método con el nombre:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="nf">findByAddressZipCode</span><span class="o">(</span><span class="n">ZipCode</span> <span class="n">zipCode</span><span class="o">);</span>
</pre></div>
</div>
<p>crea la propiedad transversal <em>x.address.zipCode</em>. El algoritmo de resolución comienza interpretando la parte entera (<em>AddressZipCode</em>) como la propiedad y verifica que la clase de dominio tenga una propiedad con ese nombre (en minúsculas). Si el algoritmo encuentra la propiedad entones la usa. Si no, el algoritmo divide la fuente en partes 'Camel Case' tomando el lado derecho como la cabeza y el resto como la cola y trata de encontrar la propiedad correspondiente, en nuestro ejemplo, _AddressZip _y <em>Code</em>. Si el algoritmo encuentra una propiedad con tal cabeza toma la cola y continúa construyendo el árbol a partir de allí, dividiendo la cola en la manera antes descrita. Si la primera división no coincide, el algoritmo mueve el punto de división a la izquierda (<em>Address, ZipCode</em>) y continúa.</p>
<p>Aunque esto debería funcionar para la mayoría de los casos, es posible que el algoritmo seleccione la propiedad equivocada. Supón que la clase <em>Person</em> tiene también una propiedad <em>AddressZip</em>. El algoritmo coincidiría en la primera ronda de división y esencialmente elegiría la propiedad equivocada y finalmente fallaría (puesto que el tipo <em>addressZip</em> probablemente no tiene la propiedad <em>code</em>).</p>
<p>Para resolver esta ambigüedad puedes usar un guión bajo (<em>_</em>) en el nombre de tu método para definir manualmente puntos transversales. Así que el nombre de nuestro método sería:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="nf">findByAddress_ZipCode</span><span class="o">(</span><span class="n">ZipCode</span> <span class="n">zipCode</span><span class="o">);</span>
</pre></div>
</div>
<p>Debido a que definimos al guión bajo como un caracter reservado recomendamos encarecidamente seguir las convenciones de nomenclatura estándar de Java (por ejemplo usar Camel Case en los nombres de las propiedades y **no **guión bajo).</p>
</div>
<div class="section" id="manejo-de-parametros-especiales">
<span id="manejo-de-parametros-especiales"></span><h3>4.4.4 Manejo de parámetros especiales<a class="headerlink" href="#manejo-de-parametros-especiales" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para manejar parámetros especiales en tu <em>query</em> simplemente define parámetros de método como ya se ha visto en los ejemplos de arriba. Además de que la infraestructura reconocerá ciertos tipos específicos tales como <em>Pageable</em> y <em>Sort</em> para aplicar paginación y ordenamiento a tus <em>queries</em> de manera dinámica.</p>
<p><strong>Ejemplo 14. Usando <strong><em><strong>Pageable</strong></em></strong>, <strong><em><strong>Slice</strong></em></strong> y Sort</strong>_** **_<strong>en los métodos de consulta</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Page</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">findByLastname</span><span class="o">(</span><span class="n">String</span> <span class="n">lastname</span><span class="o">,</span> <span class="n">Pageable</span> <span class="n">pageable</span><span class="o">);</span>

<span class="n">Slice</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">findByLastname</span><span class="o">(</span><span class="n">String</span> <span class="n">lastname</span><span class="o">,</span> <span class="n">Pageable</span> <span class="n">pageable</span><span class="o">);</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">findByLastname</span><span class="o">(</span><span class="n">String</span> <span class="n">lastname</span><span class="o">,</span> <span class="n">Sort</span> <span class="n">sort</span><span class="o">);</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">findByLastname</span><span class="o">(</span><span class="n">String</span> <span class="n">lastname</span><span class="o">,</span> <span class="n">Pageable</span> <span class="n">pageable</span><span class="o">);</span>
</pre></div>
</div>
<p>El primer método permite que le pases una instancia de <em>org.springframework.data.domain.Pageable</em> al método de consulta para añadir dinámicamente paginación a tu <em>query</em> definido estáticamente. Una <em>Page</em> sabe el número total de elementos y páginas disponibles. Lo hace por la infraestructura que activa una consulta de recuento para calcular el número total.
Aunque esto podría ser costoso dependiendo del almacén que se utilice, en su lugar puede utilizarse <em>Slice</em>. Un <em>Slice</em> solo sabe si hay otro <em>Slice</em> disponible lo cual podría ser suficiente cuando se recorre un conjunto de resultados grande.</p>
<p>Las opciones de ordenamiento también se manejan mediante la instancia <em>Pageable</em>. Si solo necesitas ordenar, simplemente añade un parámetro <em>org.springframework.data.domain.Sort</em> a tu método. Como puedes ver, también es posible retornar una <em>List</em>. En este caso los metadatos requeridos para construir la instancia <em>Page</em> no serán creados (lo cual a su vez significa que no se ejecuta el <em>query</em> adicional que hace el recuento) sino simplemente restringe que el <em>query</em> busque solo el rango proporcionado de entidades.</p>
<blockquote>
<div>Para descubrir cuántas páginas se obtienen en total tienes que ejecutar una consulta de recuento adicional. Por defecto esta consulta será derivada del <em>query</em> que se ejecuta.</div></blockquote>
</div>
<div class="section" id="limitando-los-resultados-de-los-queries">
<span id="limitando-los-resultados-de-los-queries"></span><h3>4.4.5 Limitando los resultados de los <em>queries</em><a class="headerlink" href="#limitando-los-resultados-de-los-queries" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Se puede limitar el resultado de los métodos de consulta mediante las palabras clave (<em>keywords</em>) <em>first</em> o <em>top</em>, los cuales se pueden usar de manera intercambiable. De manera opcional se puede añadir al principio un valor numérico para especificar el tamaño máximo del resultado a retornar. Si se omite este número se asume un tamaño de resultado de 1.</p>
<p>**Ejemplo 15. Limitando el tamaño del resultado de un <strong><em><strong>query</strong></em></strong> con **_**Top **_**y **<em><strong>First</strong></em></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">User</span> <span class="n">findFirstByOrderByLastnameAsc</span><span class="p">();</span>

<span class="n">User</span> <span class="n">findTopByOrderByAgeDesc</span><span class="p">();</span>

<span class="n">Page</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">queryFirst10ByLastname</span><span class="p">(</span><span class="n">String</span> <span class="n">lastname</span><span class="p">,</span> <span class="n">Pageable</span> <span class="n">pageable</span><span class="p">);</span>

<span class="n">Slice</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">findTop3ByLastname</span><span class="p">(</span><span class="n">String</span> <span class="n">lastname</span><span class="p">,</span> <span class="n">Sort</span> <span class="n">sort</span><span class="p">);</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">findFirst10ByLastname</span><span class="p">(</span><span class="n">String</span> <span class="n">lastname</span><span class="p">,</span> <span class="n">Sort</span> <span class="n">sort</span><span class="p">);</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">findTop10ByLastname</span><span class="p">(</span><span class="n">String</span> <span class="n">lastname</span><span class="p">,</span> <span class="n">Pageable</span> <span class="n">pageable</span><span class="p">);</span>
</pre></div>
</div>
<p>Al limitar las expresiones también se puede utilizar la palabra clave <em>Distinct</em>. En el caso de los <em>queries</em> que limitan el resultado a una sola instancia, también se puede 'envolver' el resultado en un <em>Optional</em>.</p>
<p>Si la paginación o el <em>slicing</em> se aplica a un <em>query</em> de paginación limitado (y al cálculo del número de páginas disponibles) entonces éstos se aplican dentro del resultado limitado.</p>
<blockquote>
<div>Nota que la limitación de resultados en combinación con el ordenamiento dinámico mediante un parámetro <em>Sort</em> permite expresar métodos de consulta para los 'K' elementos más pequeños así como también a los 'K' elementos más grandes.</div></blockquote>
</div>
<div class="section" id="streaming-de-resultados-de-queries">
<span id="streaming-de-resultados-de-queries"></span><h3>4.4.6 <em>Streaming</em> de resultados de <em>queries</em><a class="headerlink" href="#streaming-de-resultados-de-queries" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Los resultados de los métodos de consulta se pueden procesar incrementalmente utilizando un <em>Stream<p>&amp;lt;</p>
T<p>&amp;gt;</p>
</em> de Java 8 como tipo de retorno. En lugar de simplemente 'envolver' (<em>wrapping</em>) los resultados de la consulta en un <em>Stream</em>, se utilizan los métodos específicos del _data store _para realizar el <em>streaming</em>.</p>
<p>**Ejemplo 16. <strong><em><strong>Streaming</strong></em></strong> de los resultados de un <strong><em><strong>query</strong></em></strong> con **_**Stream<p>&amp;lt;</p>
T<p>&amp;gt;</p>
 **_<strong>de Java 8</strong></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Query</span><span class="o">(</span><span class="s">&quot;select u from User u&quot;</span><span class="o">)</span>
<span class="n">Stream</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">findAllByCustomQueryAndStream</span><span class="o">();</span>

<span class="n">Stream</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">readAllByFirstnameNotNull</span><span class="o">();</span>

<span class="nd">@Query</span><span class="o">(</span><span class="s">&quot;select u from User u&quot;</span><span class="o">)</span>
<span class="n">Stream</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">streamAllPaged</span><span class="o">(</span><span class="n">Pageable</span> <span class="n">pageable</span><span class="o">);</span>
</pre></div>
</div>
<blockquote>
<div>Un <em>Stream</em> 'envuelve'  potencialmente los recursos específicos del <em>data store</em> subyacente y debe por lo tanto cerrarse después de usarse. También puedes cerrar el <em>Stream</em> usando el método <em>close()</em> o usando el bloque <em>try-with-resources</em> de Java 7.</div></blockquote>
<p>**Ejemplo 17. Trabajando con un resultado <strong><em><strong>Stream<p>&amp;lt;</p>
T<p>&amp;gt;</p>
</strong></em></strong> en un bloque **<em><strong>try-with-resources</strong></em></p>
<div class="highlight-java"><div class="highlight"><pre><span></span>try (Stream&lt;User&gt; stream = repository.findAllByCustomQueryAndStream()) {
  stream.forEach(…);
}
</pre></div>
</div>
<blockquote>
<div>Actualmente no todos los módulos de Spring Data soportan _Stream<p>&amp;lt;</p>
T<p>&amp;gt;</p>
 _como tipo de retorno.</div></blockquote>
</div>
<div class="section" id="resultados-de-queries-asincronos">
<span id="resultados-de-queries-asincronos"></span><h3>4.4.7 Resultados de _queries _asíncronos<a class="headerlink" href="#resultados-de-queries-asincronos" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Las consultas a los repositorios se pueden ejecutar de manera asíncrona utilizando la capacidad de ejecución asíncrona de métodos de Spring. Esto significa que el método retornará inmediatamente después de la invocación y realmente la ejecución del <em>query</em> ocurrirá en una tarea que se envía al Ejecutor de Tareas de Spring (<em>Spring Task Executor</em>).</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Async</span>
<span class="n">Future</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">findByFirstname</span><span class="o">(</span><span class="n">String</span> <span class="n">firstname</span><span class="o">);</span>   <span class="c1">// Usa a java.util.concurrent.Future como tipo de retorno            </span>

<span class="nd">@Async</span>
<span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">findOneByFirstname</span><span class="o">(</span><span class="n">String</span> <span class="n">firstname</span><span class="o">);</span> <span class="c1">// Usa a java.util.concurrent.CompletableFuture de Java 8 como tipo de retorno</span>

<span class="nd">@Async</span>
<span class="n">ListenableFuture</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">findOneByLastname</span><span class="o">(</span><span class="n">String</span> <span class="n">lastname</span><span class="o">);</span><span class="c1">// Usa a org.springframework.util.concurrent.ListenableFuture como tipo de retorno.</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="spring-boot-reference.html" class="btn btn-neutral float-right" title="Spring Boot: Guía de referencia" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Spring: documentación en español" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, DADS Infotec.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>